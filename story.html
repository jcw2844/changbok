<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì°½ì™„ì˜ ì—„ë³µë™ íƒêµ¬</title>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <script src="https://unpkg.com/n3/browser/n3.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Gaegu&family=Jua&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #FFF9C4;
            /* ì—°í•œ ë…¸ë‘ (ìŠ¤ì¼€ì¹˜ë¶ ëŠë‚Œ) */
            --panel-bg: white;
            --main-color: #FF8A65;
            /* ë”°ëœ»í•œ ì£¼í™© */
            --accent-color: #4DB6AC;
            /* ë¯¼íŠ¸ */
            --text-color: #5D4037;
            /* ì§„í•œ ê°ˆìƒ‰ (ë¶€ë“œëŸ¬ìš´ ê¸€ììƒ‰) */
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 20px;
            font-family: 'Jua', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#F0F4C3 15%, transparent 16%), radial-gradient(#F0F4C3 15%, transparent 16%);
            background-size: 30px 30px;
            color: var(--text-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
            /* ì„¸ë¡œ ë°°ì¹˜ */
            gap: 20px;
            overflow: hidden;
        }

        .app-body {
            display: flex;
            flex: 1;
            gap: 20px;
            min-height: 0;
            width: 100%;
        }

        /* --- ì™¼ìª½: ì„¤ëª… & ì±„íŒ… --- */
        .sidebar {
            width: 420px;
            height: 100%;
            /* Fix: Constrain height to parent */
            display: flex;
            flex-direction: column;
            gap: 20px;
            flex-shrink: 0;
        }

        .panel {
            background: var(--panel-bg);
            border-radius: 25px;
            padding: 25px;
            box-shadow: 5px 5px 0px rgba(0, 0, 0, 0.1);
            border: 4px solid var(--main-color);
        }

        header {
            background: #FFAB91;
            padding: 10px 20px;
            border-radius: 20px;
            border: 4px solid #D84315;
            box-shadow: 5px 5px 0px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            text-align: center;
        }

        h1 {
            font-size: 4rem;
            /* ì œëª© í¬ê¸° ëŒ€í­ í™•ëŒ€ */
            color: #fff;
            margin: 0;
            text-shadow: 4px 4px 0px #BF360C;
            font-family: 'Jua', sans-serif;
            letter-spacing: 2px;
        }

        .mission-box {
            background: #FFF176;
            border: 4px solid #FBC02D;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 3px 3px 0 rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .mission-title {
            font-size: 1.5rem;
            color: #F57F17;
            font-weight: bold;
            margin-bottom: 10px;
            border-bottom: 2px dashed #F9A825;
            padding-bottom: 5px;
        }

        .mission-list {
            list-style: none;
            padding: 0;
            margin: 0;
            font-size: 1.3rem;
            font-family: 'Gaegu', cursive;
        }

        .mission-list li {
            margin-bottom: 5px;
        }

        .quiz-btn {
            background: #AB47BC;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 20px;
            font-family: 'Jua', sans-serif;
            font-size: 1.1rem;
            cursor: pointer;
            margin-left: 10px;
            box-shadow: 0 3px #7B1FA2;
        }

        .quiz-btn:active {
            box-shadow: 0 0;
            transform: translateY(3px);
        }

        .description {
            font-family: 'Gaegu', cursive;
            font-size: 1.5rem;
            line-height: 1.6;
            text-align: center;
            background: #E0F2F1;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        /* ì•Œë¡ë‹¬ë¡ ë²”ë¡€ */
        .legend {
            background: #FFF3E0;
            padding: 15px;
            border-radius: 15px;
            border: 2px dashed #FFB74D;
        }

        .legend-item {
            font-size: 1.3rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }

        .legend-icon {
            font-size: 1.5rem;
            margin-right: 10px;
            width: 30px;
            text-align: center;
        }

        /* --- ì±„íŒ…ì°½ --- */
        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-color: var(--accent-color);
            background: #E0F7FA;
            min-height: 0;
            /* Fix: Allow flex shrinking for scroll */
        }

        .chat-header {
            font-size: 1.8rem;
            color: #00897B;
            margin-bottom: 10px;
            text-align: center;
        }

        .chat-messages {
            flex: 1;
            overflow-y: scroll;
            /* í•­ìƒ ìŠ¤í¬ë¡¤ í‘œì‹œ */
            background: white;
            border-radius: 15px;
            padding: 15px;
            padding-right: 5px;
            /* ìŠ¤í¬ë¡¤ë°” ê³µê°„ í™•ë³´ */
            margin-bottom: 15px;
            border: 3px solid #B2DFDB;
            font-family: 'Gaegu', cursive;
            font-size: 1.6rem;
            min-height: 0;
            /* Fix: Enable scrolling inside flex item */
        }

        .chat-messages::-webkit-scrollbar {
            width: 15px;
            /* ìŠ¤í¬ë¡¤ë°” ë” ë„“ê²Œ */
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: #FFCC80;
            /* ë°ì€ ì£¼í™©ìƒ‰ */
            border-radius: 10px;
            border: 3px solid white;
            /* í°ìƒ‰ í…Œë‘ë¦¬ë¡œ ë‘¥ê¸€ê²Œ í‘œí˜„ */
        }

        .chat-messages::-webkit-scrollbar-track {
            background: #E0F2F1;
            /* ë¶€ë“œëŸ¬ìš´ ë°°ê²½ìƒ‰ ì¶”ê°€ */
            border-radius: 10px;
            margin: 5px;
        }

        .message {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 20px;
            word-break: keep-all;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            from {
                transform: scale(0.5);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .bot-msg {
            background: #FFF176;
            color: #5D4037;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
            box-shadow: 2px 2px 0px rgba(0, 0, 0, 0.1);
        }

        .user-msg {
            background: #FFAB91;
            color: white;
            text-align: right;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
            box-shadow: 2px 2px 0px rgba(0, 0, 0, 0.1);
            margin-left: auto;
            /* ì˜¤ë¥¸ìª½ ì •ë ¬ */
            width: fit-content;
        }

        .input-group {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 15px;
            border-radius: 30px;
            border: 3px solid #80CBC4;
            font-family: 'Jua', sans-serif;
            font-size: 1.3rem;
            outline: none;
        }

        .chat-input:focus {
            border-color: #009688;
        }

        .send-btn {
            background: #26A69A;
            color: white;
            border: none;
            padding: 0 25px;
            border-radius: 30px;
            font-family: 'Jua', sans-serif;
            font-size: 1.3rem;
            cursor: pointer;
            box-shadow: 0 4px #00796B;
            transition: all 0.1s;
        }

        .send-btn:active {
            box-shadow: 0 0 #00796B;
            transform: translateY(4px);
        }

        /* --- ì˜¤ë¥¸ìª½: ê·¸ë˜í”„ --- */
        .main-content {
            flex: 1;
            background: white;
            border-radius: 25px;
            border: 4px solid var(--text-color);
            box-shadow: 8px 8px 0px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
        }

        #mynetwork {
            width: 100%;
            height: 100%;
        }

        .hint-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #FFEB3B;
            color: #333;
            padding: 10px 20px;
            border-radius: 50px;
            font-size: 1.5rem;
            border: 3px solid #FBC02D;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            animation: bounce 2s infinite;
            pointer-events: none;
        }

        @keyframes bounce {

            0%,
            20%,
            50%,
            80%,
            100% {
                transform: translateY(0);
            }

            40% {
                transform: translateY(-10px);
            }

            60% {
                transform: translateY(-5px);
            }
        }
    </style>
</head>

<body>

    <!-- í—¤ë” (ì œëª©) -->
    <header>
        <h1>ì°½ì™„ì˜ ì—„ë³µë™ íƒêµ¬</h1>
    </header>

    <div class="app-body">
        <div class="sidebar">
            <!-- í•™ìŠµ ëª©í‘œ (ë¯¸ì…˜ ë³´ë“œ) -->
            <div class="panel">
                <div class="mission-box">
                    <div class="mission-title">ğŸ¯ ì˜¤ëŠ˜ì˜ íƒêµ¬ ë¯¸ì…˜</div>
                    <ul class="mission-list">
                        <li>1. ê·¸ë˜í”„ì—ì„œ <b>ì—„ë³µë™</b> ì°¾ê¸°</li>
                        <li>2. <b>í•„ì‚´ê¸°</b>ê°€ ë¬´ì—‡ì¸ì§€ ì•Œì•„ë³´ê¸°</li>
                        <li>3. ì±—ë´‡ì—ê²Œ <b>í€´ì¦ˆ</b> ë„ì „í•˜ê¸°!</li>
                    </ul>
                </div>

                <div class="description" style="display:none;">
                    ì¹œêµ¬ë“¤ ì•ˆë…•! ğŸ‘‹<br>
                    ë‚˜ëŠ” ìì „ê±° ìš”ì •ì´ì•¼.<br>
                    ì—„ë³µë™ í• ì•„ë²„ì§€ì˜ ë©‹ì§„ ì´ì•¼ê¸°ë¥¼<br>
                    í•¨ê»˜ ì•Œì•„ë³´ì!
                </div>

                <div class="legend">
                    <div class="legend-item"><span class="legend-icon">ğŸ˜</span> ì—„ë³µë™ í• ì•„ë²„ì§€</div>
                    <div class="legend-item"><span class="legend-icon">ğŸš²</span> ì”½ì”½ ìì „ê±°</div>
                    <div class="legend-item"><span class="legend-icon">ğŸ†</span> ì‹ ë‚˜ëŠ” ì‹œí•©</div>
                    <div class="legend-item"><span class="legend-icon">âœ¨</span> íŠ¹ë³„í•œ ì´ì•¼ê¸°</div>
                </div>
            </div>

            <!-- ì±—ë´‡ -->
            <div class="panel chat-container">
                <div class="chat-header">
                    ğŸ¤– ê¶ê¸ˆì´ ìš”ì •
                    <button class="quiz-btn" onclick="startQuiz()">âš¡ í€´ì¦ˆ ë„ì „!</button>
                </div>
                <div class="chat-messages" id="chatWindow">
                    <div class="message bot-msg">
                        ì•ˆë…•? ë‚œ ê¶ê¸ˆì´ ìš”ì •ì´ì•¼! ğŸ§šâ€â™€ï¸<br>
                        "í•„ì‚´ê¸°ê°€ ë­ì•¼?" <br>
                        "ëˆ„êµ¬ë‘ ì‹œí•©í–ˆì–´?"<br>
                        ì´ë ‡ê²Œ ë¬¼ì–´ë´ ì¤˜!
                    </div>
                </div>
                <div class="input-group">
                    <input type="text" id="userInput" class="chat-input" placeholder="ì—¬ê¸°ì— ë¬¼ì–´ë´!"
                        onkeypress="handleEnter(event)">
                    <button class="send-btn" onclick="sendMessage()">ë¬¼ì–´ë³´ê¸°</button>
                </div>

                <!-- íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ ì¶”ê°€ -->
                <div style="margin-top: 20px; text-align: center; border-top: 2px dashed #B2DFDB; padding-top: 20px;">
                    <p style="font-size: 1.2rem; color: #00796B; margin-bottom: 10px;">ğŸ“„ ì´ì•¼ê¸° íŒŒì¼(story.ttl) ë¶ˆëŸ¬ì˜¤ê¸°</p>
                    <input type="file" id="fileInput" accept=".ttl" style="display: none;"
                        onchange="loadTTLFile(event)">
                    <label for="fileInput" class="send-btn"
                        style="background: #FFB74D; display: inline-block; padding: 10px 20px; font-size: 1.1rem;">
                        ğŸ“‚ íŒŒì¼ ì„ íƒ
                    </label>
                </div>
            </div>
        </div>

        <!-- ê·¸ë˜í”„ -->
        <div class="main-content">
            <div id="mynetwork"></div>
            <div class="hint-badge">ğŸˆ ë™ê·¸ë¼ë¯¸ë¥¼ í†¡! ê±´ë“œë ¤ë´</div>
        </div>
    </div>

    <script>
        // --- ë°ì´í„° (ì´ˆë“±í•™ìƒìš© ìš©ì–´ë¡œ ìˆœí™”) ---
        const nodesArray = [
            // í•µì‹¬ 3ê°€ì§€
            { id: 1, label: 'ì—„ë³µë™\n(ìš°ë¦¬ ì˜ì›…) ğŸ˜', group: 'hero' },
            { id: 2, label: 'ìì „ê±°\n(ë³´ë¬¼ 1í˜¸) ğŸš²', group: 'item' },
            { id: 3, label: 'ìì „ê±° ì‹œí•©\n(ë‘ê·¼ë‘ê·¼) ğŸ', group: 'event' },

            // ì„¤ëª…ë“¤
            { id: 11, label: 'ì§ì—…\nìì „ê±° ì„ ìˆ˜ ğŸš´', group: 'info' },
            { id: 12, label: 'ë³„ëª…\nìì „ì°¨ì™• ğŸ‘‘', group: 'info' },
            { id: 13, label: 'í•„ì‚´ê¸°\nì—‰ë©ì´ ë“¤ê¸°! ğŸš€', group: 'star' }, // ê°•ì¡°
            { id: 14, label: 'ì‚¬ëŒë“¤ì˜ ì¹­ì°¬\n"ë•…ì—ëŠ” ì—„ë³µë™!" ğŸ‘', group: 'quote' },

            { id: 21, label: 'ë§Œë“  ë‚˜ë¼\nì˜êµ­ ğŸ‡¬ğŸ‡§', group: 'info' },
            { id: 22, label: 'ì§€ê¸ˆì€?\në°•ë¬¼ê´€ì— ìˆì–´ ğŸ›ï¸', group: 'info' },

            { id: 31, label: 'ì¥ì†Œ\nì„œìš¸ (ê²½ì„±) ğŸ™ï¸', group: 'info' },
            { id: 32, label: 'ê²°ê³¼\nìš°ìŠ¹í–ˆì–´ìš”! ğŸ¥‡', group: 'star' }
        ];

        const edgesArray = [
            { from: 1, to: 2, label: 'íƒ€ê³  ë‹¬ë ¤ìš”', arrows: 'to' },
            { from: 1, to: 3, label: 'ìš°ìŠ¹í–ˆì–´ìš”', arrows: 'to' },

            { from: 1, to: 11 }, { from: 1, to: 12 },
            { from: 1, to: 13, width: 3, dashes: true, color: { color: '#FF7043' } },
            { from: 1, to: 14 },

            { from: 2, to: 21 }, { from: 2, to: 22 },

            { from: 3, to: 31 },
            { from: 3, to: 32, width: 3, dashes: true, color: { color: '#FFCA28' } }
        ];

        // --- íŒŒì¼ ë¡œë”© ë° íŒŒì‹± ë¡œì§ ---
        function loadTTLFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                const content = e.target.result;
                parseAndDraw(content);
            };
            reader.readAsText(file);
        }

        function parseAndDraw(ttlContent) {
            const parser = new N3.Parser();
            const newNodes = [];
            const newEdges = [];

            // ID ë§¤í•‘ì„ ìœ„í•œ ë§µ
            const uriToId = {};
            let idCounter = 100;

            const store = new N3.Store();
            parser.parse(ttlContent, (error, quad, prefixes) => {
                if (quad) {
                    store.addQuad(quad);
                } else {
                    // íŒŒì‹± ì™„ë£Œ í›„ ë°ì´í„° ì²˜ë¦¬
                    processStore(store);
                }
            });

            function getOrCreateId(uri, type) {
                if (!uriToId[uri]) {
                    uriToId[uri] = ++idCounter;

                    // ê¸°ë³¸ ë¼ë²¨ì€ URI ë’·ë¶€ë¶„
                    let label = uri.split(/[\/#]/).pop();
                    let group = 'info';

                    // íƒ€ì…ì— ë”°ë¥¸ ê·¸ë£¹ ë° ì•„ì´ì½˜ ì„¤ì •
                    if (type === 'http://xmlns.com/foaf/0.1/Person') {
                        group = 'hero';
                        label += ' ğŸ˜';
                    } else if (type === 'https://schema.org/Product') {
                        group = 'item';
                        label += ' ğŸš²';
                    } else if (type === 'https://schema.org/Event') {
                        group = 'event';
                        label += ' ğŸ';
                    }

                    newNodes.push({ id: uriToId[uri], label: label, group: group, originalUri: uri });
                }
                return uriToId[uri];
            }

            function processStore(store) {
                // 1. ëª¨ë“  ì£¼ì–´(Subject)ë¥¼ ì°¾ì•„ì„œ ë…¸ë“œ ìƒì„±
                const subjects = new Set();
                store.forEach(quad => {
                    subjects.add(quad.subject.value);
                }, null, null, null);

                // íƒ€ì… ì •ë³´ ë¨¼ì € ìŠ¤ìº”í•˜ì—¬ ë…¸ë“œ ìƒì„± ì‹œ ê·¸ë£¹ ë°˜ì˜
                subjects.forEach(sub => {
                    const typeQuads = store.getQuads(sub, 'http://www.w3.org/1999/02/22-rdf-syntax-ns#type', null);
                    let type = typeQuads.length > 0 ? typeQuads[0].object.value : null;
                    getOrCreateId(sub, type);
                });

                // 2. ì†ì„±ê³¼ ê´€ê³„ ì²˜ë¦¬
                store.forEach(quad => {
                    if (quad.predicate.value === 'http://www.w3.org/1999/02/22-rdf-syntax-ns#type') return; // íƒ€ì… ì •ì˜ëŠ” ì´ë¯¸ ì²˜ë¦¬í•¨

                    const subjectId = uriToId[quad.subject.value];
                    const pred = quad.predicate.value.split(/[\/#]/).pop(); // example: 'name' from foaf:name

                    if (quad.object.termType === 'Literal') {
                        // ë¦¬í„°ëŸ´ ê°’ì€ 'ì†ì„± ë…¸ë“œ'ë¡œ ë§Œë“¤ì–´ì„œ ì—°ê²° (ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€)
                        const attrId = ++idCounter;
                        let attrLabel = pred + '\n' + quad.object.value;

                        // ë³´ê¸° ì¢‹ê²Œ ë‹¤ë“¬ê¸°
                        if (pred === 'name' || pred === 'title') {
                            // ì´ë¦„/ì œëª©ì€ ë…¸ë“œ ìì²´ ë¼ë²¨ë¡œ ì—…ë°ì´íŠ¸
                            const node = newNodes.find(n => n.id === subjectId);
                            if (node) node.label = quad.object.value + (node.group === 'hero' ? ' ğŸ˜' : node.group === 'item' ? ' ğŸš²' : node.group === 'event' ? ' ğŸ' : '');
                            return;
                        }

                        // ë¦¬í„°ëŸ´ ë…¸ë“œ ì¶”ê°€
                        newNodes.push({ id: attrId, label: attrLabel.replace('description', 'ì„¤ëª…'), group: 'info', shape: 'ellipse' });
                        newEdges.push({ from: subjectId, to: attrId });

                    } else if (quad.object.termType === 'NamedNode') {
                        // ë‹¤ë¥¸ ë…¸ë“œì™€ì˜ ê´€ê³„ (Edge)
                        // ì•„ì§ ë…¸ë“œê°€ ì—†ë‹¤ë©´ ìƒì„± (íƒ€ì… ëª¨ë¦„)
                        const objectId = getOrCreateId(quad.object.value, null);
                        newEdges.push({ from: subjectId, to: objectId, label: pred, arrows: 'to' });
                    }
                });

                // ë„¤íŠ¸ì›Œí¬ ì—…ë°ì´íŠ¸
                data.nodes.clear();
                data.edges.clear();
                data.nodes.add(newNodes);
                data.edges.add(newEdges);
                network.fit(); // í™”ë©´ ë§ì¶¤
            }
        }

        // --- Vis.js ì„¤ì • (ê·€ì—¬ìš´ ìŠ¤íƒ€ì¼) ---
        const container = document.getElementById('mynetwork');
        const data = {
            nodes: new vis.DataSet(nodesArray),
            edges: new vis.DataSet(edgesArray)
        };

        const options = {
            nodes: {
                borderWidth: 3,
                shadow: true,
                font: { size: 20, face: 'Jua', color: 'white', bold: true },
                shape: 'box',
                margin: 12
            },
            groups: {
                hero: { color: { background: '#FF7043', border: '#D84315' }, font: { size: 24 } }, // ë¹¨ê°• ì£¼í™©
                item: { color: { background: '#FFCA28', border: '#F57F17' }, font: { color: '#3E2723' } }, // ë…¸ë‘
                event: { color: { background: '#42A5F5', border: '#1565C0' } }, // íŒŒë‘
                info: { color: { background: '#8D6E63', border: '#5D4037' }, shape: 'ellipse', font: { size: 16 } }, // ê°ˆìƒ‰ (ë‚˜ë¬´ìƒ‰)
                star: {
                    color: { background: '#FFFF00', border: '#FBC02D' },
                    shape: 'star',
                    size: 50,
                    font: { color: '#333', background: 'white' }
                },
                quote: {
                    color: { background: '#FFF9C4', border: '#FBC02D' },
                    shape: 'box',
                    font: { color: '#5D4037', size: 16, face: 'Gaegu' }
                }
            },
            edges: {
                width: 3,
                color: { color: '#BCAAA4' }, // ì—°í•œ ê°ˆìƒ‰
                font: { size: 14, face: 'Jua', align: 'middle', background: 'white', strokeWidth: 0 }
            },
            physics: {
                barnesHut: { springLength: 200, avoidOverlap: 0.5 },
                stabilization: false
            }
        };

        const network = new vis.Network(container, data, options);

        // --- ì±—ë´‡ (ì¹œì ˆí•œ ë§íˆ¬) ---
        const chatWindow = document.getElementById('chatWindow');
        const userInputBlock = document.getElementById('userInput');

        const knowledgeBase = [
            {
                keywords: ['í•„ì‚´ê¸°', 'ê¸°ìˆ ', 'ì˜í•˜ëŠ”ê±°', 'ì—‰ë©ì´'],
                answer: "ì—„ë³µë™ í• ì•„ë²„ì§€ì˜ í•„ì‚´ê¸°ëŠ” 'ì—‰ë©ì´ ë“¤ê¸°'ì•¼! ì—‰ë©ì´ë¥¼ ë²ˆì© ë“¤ê³  í˜ë‹¬ì„ ë°Ÿìœ¼ë©´ ìŒ©~ í•˜ê³  ë‚ ì•„ê°”ëŒ€! ğŸš€"
            },
            {
                keywords: ['ëˆ„êµ¬', 'ì—„ë³µë™'],
                answer: "ìš°ë¦¬ë‚˜ë¼ê°€ í˜ë“¤ ë•Œ ì¼ë³¸ ì„ ìˆ˜ë“¤ì„ ì´ê²¨ì„œ í˜ì„ ì¤€ ìµœê³ ì˜ ìì „ê±° ì„ ìˆ˜ì•¼! ğŸ˜"
            },
            {
                keywords: ['ìì „ê±°', 'ë¬´ì—‡'],
                answer: "ì˜êµ­ì—ì„œ ë§Œë“  ì•„ì£¼ íŠ¼íŠ¼í•œ ìì „ê±°ì•¼. ì§€ê¸ˆì€ ë°•ë¬¼ê´€ì—ì„œ ì‰¬ê³  ìˆì–´. ğŸš²"
            },
            {
                keywords: ['ì‹œí•©', 'ê²½ê¸°', 'ëŒ€íšŒ', 'ìƒ', 'ìš°ìŠ¹'],
                answer: "ì¼ë³¸ ì„ ìˆ˜ë“¤ì´ë‘ ì‹œí•©í–ˆëŠ”ë°, ìš°ë¦¬ ì—„ë³µë™ í• ì•„ë²„ì§€ê°€ 1ë“±ìœ¼ë¡œ ë“¤ì–´ì™”ì–´! ë§Œì„¸! ğŸ‡°ğŸ‡·ğŸ™Œ"
            },
            {
                keywords: ['ì•ˆë…•'],
                answer: "ì•ˆë…•! ë§Œë‚˜ì„œ ë°˜ê°€ì›Œ. ê¶ê¸ˆí•œ ê±° ìˆìœ¼ë©´ ë‹¤ ë¬¼ì–´ë´! ğŸ‘‹"
            }
        ];

        function handleEnter(event) { if (event.key === 'Enter') sendMessage(); }

        function sendMessage() {
            const text = userInputBlock.value.trim();
            if (text === "") return;

            addMessage(text, 'user-msg');
            userInputBlock.value = "";

            setTimeout(() => {
                const response = getBotResponse(text);
                addMessage(response, 'bot-msg');
            }, 700);
        }

        function addMessage(text, className) {
            const msgDiv = document.createElement('div');
            msgDiv.className = `message ${className}`;
            msgDiv.innerHTML = text;
            chatWindow.appendChild(msgDiv);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        // --- í€´ì¦ˆ ë¡œì§ ---
        const quizBank = [
            { question: "ì—„ë³µë™ í• ì•„ë²„ì§€ì˜ í•„ì‚´ê¸°ëŠ” ë¬´ì—‡ì¼ê¹Œìš”? (íŒíŠ¸: ã…‡ã„·ã…‡)", answer: "ì—‰ë©ì´" },
            { question: "ì—„ë³µë™ í• ì•„ë²„ì§€ê°€ ìš°ìŠ¹í•œ ëŒ€íšŒê°€ ì—´ë¦° ê³³ì€ ì–´ë””ì¸ê°€ìš”?", answer: "ì„œìš¸" },
            { question: "ì—„ë³µë™ í• ì•„ë²„ì§€ì˜ ìì „ê±°ëŠ” ì–´ëŠ ë‚˜ë¼ì—ì„œ ë§Œë“¤ì—ˆë‚˜ìš”?", answer: "ì˜êµ­" }
        ];

        let currentQuizIndex = -1;
        let isQuizMode = false;

        function startQuiz() {
            isQuizMode = true;
            currentQuizIndex = Math.floor(Math.random() * quizBank.length); // ëœë¤ í€´ì¦ˆ
            addMessage(`[í€´ì¦ˆ ì‹œê°„!] ğŸ“¢<br>${quizBank[currentQuizIndex].question}`, 'bot-msg');
        }

        function getBotResponse(text) {
            // í€´ì¦ˆ ëª¨ë“œì¼ ê²½ìš° ì •ë‹µ í™•ì¸
            if (isQuizMode) {
                isQuizMode = false; // í€´ì¦ˆ ì¢…ë£Œ (í•œ ë¬¸ì œì”©)
                if (text.includes(quizBank[currentQuizIndex].answer)) {
                    return "ë”©ë™ëŒ•! ì •ë‹µì´ì•¼! ì°¸ ì˜í–ˆì–´! ğŸ‰ğŸ’¯";
                } else {
                    return `ë•¡! ì•„ì‰½ë‹¤.. ì •ë‹µì€ '${quizBank[currentQuizIndex].answer}'ì˜€ì–´. ë‹¤ì‹œ ë„ì „í•´ë´! ğŸ˜‰`;
                }
            }

            for (let item of knowledgeBase) {
                for (let keyword of item.keywords) {
                    if (text.includes(keyword)) return item.answer;
                }
            }
            return "ìŒ? ê·¸ê±´ ë‚´ê°€ ì˜ ëª¨ë¥´ëŠ” ì´ì•¼ê¸°ì•¼. <br>'ìì „ê±°'ë‚˜ 'í•„ì‚´ê¸°'ì— ëŒ€í•´ ë¬¼ì–´ë´ ì¤„ë˜? ğŸ˜º";
        }
    </script>
</body>

</html>